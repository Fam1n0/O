<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Dynamic Entity Simulation</title><style>body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000}canvas{display:block}#fullscreen-button{position:absolute;top:10px;right:10px;padding:10px;background:#fff;border:none;border-radius:5px;cursor:pointer;opacity:0.7}#fullscreen-button:hover{opacity:1}</style></head><body><canvas id="canvas"></canvas><button id="fullscreen-button" onclick="toggleFullScreen()">Fullscreen</button><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script>const scene=new THREE.Scene(),camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000),renderer=new THREE.WebGLRenderer({canvas:document.getElementById('canvas'),antialias:true});renderer.setSize(window.innerWidth,window.innerHeight);camera.position.z=20;const ambientLight=new THREE.AmbientLight(0x404040);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(0xffffff,1);directionalLight.position.set(5,10,7.5).normalize();scene.add(directionalLight);const sephirot={"Keter":{color:0xffffff,attributes:{wisdom:10,mercy:10,strength:10}},"Chokmah":{color:0xffff00,attributes:{wisdom:10,mercy:5,strength:5}},"Binah":{color:0x0000ff,attributes:{wisdom:8,mercy:5,strength:7}},"Chesed":{color:0x00ff00,attributes:{wisdom:6,mercy:10,strength:4}},"Gevurah":{color:0xff0000,attributes:{wisdom:4,mercy:4,strength:10}},"Tiphereth":{color:0xffff00,attributes:{wisdom:7,mercy:7,strength:7}},"Netzach":{color:0x00ff7f,attributes:{wisdom:5,mercy:9,strength:6}},"Hod":{color:0xff7f00,attributes:{wisdom:6,mercy:5,strength:9}},"Yesod":{color:0x8a2be2,attributes:{wisdom:5,mercy:8,strength:6}},"Malkuth":{color:0x8b4513,attributes:{wisdom:5,mercy:5,strength:5}}};const buildings=[],resources=[],trails=[];class ResourceNode{constructor(type,position){this.type=type;this.geometry=type==='wood'?new THREE.CylinderGeometry(0.5,0.5,2,8):new THREE.BoxGeometry(1,1,1);this.material=new THREE.MeshStandardMaterial({color:type==='wood'?0x8B4513:0xA9A9A9});this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.position.copy(position);this.amount=100;scene.add(this.mesh);resources.push(this)}gather(amount){this.amount-=amount;if(this.amount<=0){scene.remove(this.mesh);resources.splice(resources.indexOf(this),1)}}}function bezierInterpolate(p0,p1,p2,p3,t){const x=Math.pow(1-t,3)*p0.x+3*Math.pow(1-t,2)*t*p1.x+3*(1-t)*Math.pow(t,2)*p2.x+Math.pow(t,3)*p3.x;const y=Math.pow(1-t,3)*p0.y+3*Math.pow(1-t,2)*t*p1.y+3*(1-t)*Math.pow(t,2)*p2.y+Math.pow(t,3)*p3.y;return new THREE.Vector3(x,y,0)}class Trail{constructor(entity){this.entity=entity;this.geometry=new THREE.BufferGeometry();this.positions=[];this.colors=[];this.material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.line=new THREE.Line(this.geometry,this.material);scene.add(this.line);this.isSolidifying=false;trails.push(this)}updateTrail(){const p0=this.entity.position.clone();const p1=this.entity.position.clone().add(new THREE.Vector3(Math.random()-0.5,Math.random()-0.5,0));const p2=this.entity.position.clone().add(new THREE.Vector3(Math.random()-0.5,Math.random()-0.5,0));const p3=this.entity.position.clone().add(this.entity.velocity.clone().multiplyScalar(10));for(let t=0;t<=1;t+=0.05){const point=bezierInterpolate(p0,p1,p2,p3,t);this.positions.push(point.x,point.y,point.z);this.colors.push(this.entity.material.color.r,this.entity.material.color.g,this.entity.material.color.b)}this.geometry.setAttribute('position',new THREE.Float32BufferAttribute(this.positions,3));this.geometry.setAttribute('color',new THREE.Float32BufferAttribute(this.colors,3));this.geometry.setDrawRange(0,this.positions.length/3);if(this.isSolidifying){this.solidifyTrail()}}solidifyTrail(){this.line.material.color.setHex(0xFFD700);this.line.material.linewidth=3}}class Entity{constructor(sephirah,role){this.sephirah=sephirah;this.role=role;this.isLeader=role==='Leader';this.geometry=new THREE.SphereGeometry(0.5,32,32);this.material=new THREE.MeshStandardMaterial({color:sephirot[sephirah].color});this.mesh=new THREE.Mesh(this.geometry,this.material);scene.add(this.mesh);this.position=new THREE.Vector3(Math.random()*10-5,Math.random()*10-5,0);this.velocity=new THREE.Vector3(Math.random()*0.04-0.02,Math.random()*0.04-0.02,0);this.mesh.position.copy(this.position);this.symbolicMemory=[];this.maxMemorySize=5;this.trail=new Trail(this);this.carrying={wood:0,stone:0};this.carryCapacity=20;this.targetNode=null;this.buildingCooldown=0.2;this.societyRules={minWood:5,minStone:5,buildHouses:3}}remember(symbol){if(this.symbolicMemory.length>=this.maxMemorySize){this.symbolicMemory.shift()}this.symbolicMemory.push(symbol)}findNearestResource(type){let closestNode=null;let minDist=Infinity;resources.forEach(node=>{if(node.type===type){const dist=node.mesh.position.distanceTo(this.position);if(dist<minDist){closestNode=node;minDist=dist}}});return closestNode}gatherResources(){if(this.targetNode&&this.targetNode.amount>0){const gatherAmount=Math.min(5,this.carryCapacity-this.carrying[this.targetNode.type]);this.targetNode.gather(gatherAmount);this.carrying[this.targetNode.type]+=gatherAmount;console.log('Gathered',gatherAmount,this.targetNode.type,'Total:',this.carrying[this.targetNode.type])}else{this.targetNode=this.findNearestResource('wood');}}storeResources(building){building.storeResource('wood',this.carrying.wood);this.carrying.wood=0}enforceRules(){if(this.isLeader){const totalWood=buildings.reduce((acc,b)=>acc+b.storage.wood,0);const totalStone=buildings.reduce((acc,b)=>acc+b.storage.stone,0);if(totalWood<this.societyRules.minWood){this.role='gatherer'}else if(totalStone<this.societyRules.minStone){this.role='gatherer'}else if(buildings.length<this.societyRules.buildHouses){this.role='builder'}else{this.role='idle'}}}adjustTrail(){this.trail.isSolidifying=true;this.trail.solidifyTrail()}constructBuilding(){if(this.role==='builder'&&this.carrying.wood>=5&&this.buildingCooldown<=0){this.adjustTrail();const pos=new THREE.Vector3(this.position.x+Math.random()*4-2,this.position.y+Math.random()*4-2,0);const building=new Building(pos,'house');this.storeResources(building);this.buildingCooldown=0.5}this.adjustColorAndIntensity()}adjustColorAndIntensity(){let hueShift=0;switch(this.role){case'Builder':hueShift=0.1;break;case'Shaper':hueShift=-0.1;break;case'Leader':hueShift=0.2;break;default:hueShift=0;}this.material.color.offsetHSL(hueShift,0,0);this.material.needsUpdate=true;if(this.isLeader||this.role==='Builder'){this.material.emissiveIntensity=Math.min(1.5,this.material.emissiveIntensity+0.1);}else{this.material.emissiveIntensity=Math.max(0.5,this.material.emissiveIntensity-0.05);}}updateSpeedAndMovement(){if(this.role==='Builder'&&this.carrying.wood>=5){this.velocity.multiplyScalar(1.2);}else if(this.role==='Shaper'){this.velocity.multiplyScalar(1.1);}else{this.velocity.multiplyScalar(0.95);if(this.velocity.length()<0.01){this.velocity.set(Math.random()*0.04-0.02,Math.random()*0.04-0.02,0);}}}update(deltaTime){this.updateSpeedAndMovement();this.position.add(this.velocity);const boundaryX=10;const boundaryY=10;if(this.position.x>boundaryX){this.position.x=-boundaryX}else if(this.position.x<-boundaryX){this.position.x=boundaryX}if(this.position.y>boundaryY){this.position.y=-boundaryY}else if(this.position.y<-boundaryY){this.position.y=boundaryY}this.mesh.position.copy(this.position);this.enforceRules();if(this.role==='builder'){this.constructBuilding()}else if(this.role==='gatherer'){this.gatherResources()}this.trail.updateTrail();this.adjustColorAndIntensity();if(this.buildingCooldown>0){this.buildingCooldown-=deltaTime}}}class Shaper extends Entity{constructor(sephirah){super(sephirah,'Shaper');this.geometry=new THREE.IcosahedronGeometry(0.5,1);this.material.color.setHex(0x00ffff)}findNearestTrail(){let closestTrail=null;let minDist=Infinity;trails.forEach(trail=>{const dist=trail.line.position.distanceTo(this.position);if(dist<minDist){closestTrail=trail;minDist=dist}});return closestTrail}shapeTrail(){const nearestTrail=this.findNearestTrail();if(nearestTrail){nearestTrail.bendTrail();console.log('Shaper bending trail')}}update(deltaTime){super.update(deltaTime);this.shapeTrail()}}class Building{constructor(position,type){this.type=type;this.geometry=new THREE.BoxGeometry(2,2,2);this.material=new THREE.MeshStandardMaterial({color:type==='house'?0x8B4513:0xA9A9A9});this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.position.copy(position);scene.add(this.mesh);this.storage={wood:0,stone:0};buildings.push(this)}storeResource(type,amount){this.storage[type]+=amount;console.log('Stored',amount,type,'Total:',this.storage[type])}update(){this.mesh.rotation.y+=0.01}}new ResourceNode('wood',new THREE.Vector3(3,3,0));new ResourceNode('stone',new THREE.Vector3(-3,-3,0));const entities=[];const sephirotNames=Object.keys(sephirot);for(let i=0;i<15;i++){const sephirah=sephirotNames[i%sephirotNames.length];const role=i===0?'Leader':(i<5?'Builder':(i<10?'Gatherer':'Shaper'));entities.push(new Entity(sephirah,role))}function animate(){requestAnimationFrame(animate);entities.forEach(entity=>entity.update(0.01));buildings.forEach(building=>building.update());renderer.render(scene,camera)}animate();function toggleFullScreen(){if(!document.fullscreenElement){document.documentElement.requestFullscreen()}else{if(document.exitFullscreen){document.exitFullscreen()}}}document.addEventListener('click',()=>{const button=document.getElementById('fullscreen-button');button.style.display=button.style.display==='none'?'block':'none'})</script></body></html>

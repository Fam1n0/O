<HTML><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Moir√© Pattern Generator with I Ching</title><style>body{margin:0;overflow:hidden;background-color:black;color:white}#controls{position:absolute;top:20px;left:20px;z-index:1;color:#fff;display:none;max-height:90vh;overflow-y:auto}#layerControls{max-height:80vh;overflow-y:auto}.slider{width:300px;margin-bottom:10px}.slider-label{display:flex;justify-content:space-between}#toggleButton{position:absolute;top:20px;right:20px;z-index:2;background-color:rgba(255,255,255,0.5);color:black;border:none;padding:10px;cursor:pointer}#fullScreenButton{position:absolute;top:60px;right:20px;z-index:2;background-color:rgba(255,255,255,0.5);color:black;border:none;padding:10px;cursor:pointer}</style></head><body><button id="toggleButton">Show Controls</button><button id="fullScreenButton">Full Screen</button><div id="controls"><div id="layerControls"></div><button id="addLayerButton">Add Layer</button><button id="saveButton">Save</button></div><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script>const hexagrams=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],colors=['#32CD32','#1E90FF','#FFD700','#FF4500'];function getRandomHexagram(){return hexagrams[Math.floor(Math.random()*hexagrams.length)]}let scene,camera,renderer,layers=[],layerCount=0;function init(){scene=new THREE.Scene();camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1E3);camera.position.z=5;renderer=new THREE.WebGLRenderer();renderer.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(renderer.domElement);document.getElementById('addLayerButton').addEventListener('click',addLayer);document.getElementById('saveButton').addEventListener('click',saveImage);document.getElementById('toggleButton').addEventListener('click',toggleControls);document.getElementById('fullScreenButton').addEventListener('click',toggleFullScreen);window.addEventListener('resize',onWindowResize,false)}function toggleControls(){const controls=document.getElementById('controls'),toggleButton=document.getElementById('toggleButton');controls.style.display==='none'?(controls.style.display='block',toggleButton.textContent='Hide Controls'):(controls.style.display='none',toggleButton.textContent='Show Controls')}function toggleFullScreen(){if(!document.fullscreenElement){document.documentElement.requestFullscreen().catch(err=>{console.log(`Error attempting to enable full-screen mode: ${err.message}`)})}else{document.exitFullscreen()}}function addLayer(){layerCount++;const hexagram=getRandomHexagram(),layerControls=document.getElementById('layerControls'),layerDiv=document.createElement('div');layerDiv.id=`layer${layerCount}`;layerDiv.innerHTML=`<div class="slider-label"><label for="speedSlider${layerCount}">Layer ${layerCount} Speed:</label><span id="speedValue${layerCount}">0.5</span></div><input type="range" id="speedSlider${layerCount}" class="slider" min="-2" max="2" step="0.01" value="0.5"><div class="slider-label"><label for="amplitudeSlider${layerCount}">Layer ${layerCount} Amplitude:</label><span id="amplitudeValue${layerCount}">0.3</span></div><input type="range" id="amplitudeSlider${layerCount}" class="slider" min="0.1" max="2" step="0.01" value="0.3"><div class="slider-label"><label for="separationSlider${layerCount}">Layer ${layerCount} Separation:</label><span id="separationValue${layerCount}">0.1</span></div><input type="range" id="separationSlider${layerCount}" class="slider" min="0.01" max="1" step="0.01" value="0.1"><div class="slider-label"><label for="directionSlider${layerCount}">Layer ${layerCount} Direction:</label><span id="directionValue${layerCount}">0</span></div><input type="range" id="directionSlider${layerCount}" class="slider" min="0" max="360" step="1" value="0"><div class="slider-label"><label for="hueSlider${layerCount}">Layer ${layerCount} Hue:</label><span id="hueValue${layerCount}">0</span></div><input type="range" id="hueSlider${layerCount}" class="slider" min="0" max="360" step="1" value="0">`;layerControls.appendChild(layerDiv);const speedSlider=document.getElementById(`speedSlider${layerCount}`),speedValue=document.getElementById(`speedValue${layerCount}`);speedSlider.addEventListener('input',e=>{layers[layerCount-1].uniforms.speed.value=parseFloat(e.target.value);speedValue.textContent=e.target.value});const amplitudeSlider=document.getElementById(`amplitudeSlider${layerCount}`),amplitudeValue=document.getElementById(`amplitudeValue${layerCount}`);amplitudeSlider.addEventListener('input',e=>{layers[layerCount-1].uniforms.amplitude.value=parseFloat(e.target.value);amplitudeValue.textContent=e.target.value});const separationSlider=document.getElementById(`separationSlider${layerCount}`),separationValue=document.getElementById(`separationValue${layerCount}`);separationSlider.addEventListener('input',e=>{layers[layerCount-1].uniforms.separation.value=parseFloat(e.target.value);separationValue.textContent=e.target.value});const directionSlider=document.getElementById(`directionSlider${layerCount}`),directionValue=document.getElementById(`directionValue${layerCount}`);directionSlider.addEventListener('input',e=>{layers[layerCount-1].uniforms.direction.value=parseFloat(e.target.value);directionValue.textContent=e.target.value});const hueSlider=document.getElementById(`hueSlider${layerCount}`),hueValue=document.getElementById(`hueValue${layerCount}`);hueSlider.addEventListener('input',e=>{layers[layerCount-1].uniforms.hue.value=parseFloat(e.target.value);hueValue.textContent=e.target.value});createLayer(layerCount,hexagram,colors[(layerCount-1)%colors.length])}function createLayer(index,hexagram,color){const geometry=new THREE.PlaneGeometry(10,10,100,100),uniforms={time:{value:0},speed:{value:0.5+hexagram/128},amplitude:{value:0.3+hexagram/256},separation:{value:0.1+hexagram/512},direction:{value:0},hue:{value:0}},material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:`uniform float time;uniform float speed;uniform float amplitude;uniform float separation;uniform float direction;uniform float hue;varying vec2 vUv;void main() {vUv=uv;vec3 pos=position;float angle=radians(direction);float dx=cos(angle)*position.x-sin(angle)*position.y;float dy=sin(angle)*position.x+cos(angle)*position.y;pos.z+=sin((dx+dy)*10.0-time*speed)*amplitude;pos.z+=separation*${index-1}.0;gl_Position=projectionMatrix*modelViewMatrix*vec4(pos,1.0);}`,fragmentShader:`uniform vec3 color;uniform float hue;varying vec2 vUv;vec3 hueShift(vec3 color,float hue){float angle=radians(hue);float s=sin(angle),c=cos(angle);mat3 rotation=mat3(0.213+0.787*c-0.213*s,0.715-0.715*c-0.715*s,0.072-0.072*c+0.928*s,0.213-0.213*c+0.143*s,0.715+0.285*c+0.140*s,0.072-0.072*c-0.283*s,0.213-0.213*c-0.787*s,0.715-0.715*c+0.715*s,0.072+0.928*c+0.072*s);return color*rotation;}void main(){gl_FragColor=vec4(hueShift(color,hue),1.0)*vec4(vUv,1.0,1.0);}`,wireframe:true,transparent:true,opacity:0.5});material.uniforms.color={value:new THREE.Color(color)};const plane=new THREE.Mesh(geometry,material);scene.add(plane);layers.push({mesh:plane,uniforms:uniforms})}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate);layers.forEach(layer=>{layer.uniforms.time.value+=0.01});renderer.render(scene,camera)}function saveImage(){renderer.render(scene,camera);const link=document.createElement('a');link.href=renderer.domElement.toDataURL('image/png');link.download=`moire_pattern_${Date.now()}.png`;link.click()}init();animate();</script></body></HTML>

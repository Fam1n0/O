<HTML>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Vision</title>
<style>
body,html{margin:0;overflow:hidden}canvas{display:block;width:100vw;height:100vh}#ctrls{position:absolute;top:10px;left:10px;z-index:10;display:none;flex-direction:column;gap:10px;background-color:rgba(0,0,0,0.5);padding:10px;border-radius:10px;max-height:90vh;overflow-y:auto}.slider-container{display:flex;flex-direction:column;gap:5px}#btns{position:absolute;top:10px;right:10px;z-index:10;display:flex;gap:10px}button{padding:10px;background:#333;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:16px}button:hover{background:#555}.slider-label{color:white}
</style>
</head>
<body>
<div id="btns"><button id="tgl">Toggle Controls</button><button id="fs">Fullscreen</button><button id="sv">Save Image</button></div>
<div id="ctrls">
<div class="slider-container"><label class="slider-label" for="overallTexture">Texture</label><input type="range" id="overallTexture" min="0" max="2" step="0.01" value="1"></div>
<div class="slider-container"><label class="slider-label" for="overallClarity">Clarity</label><input type="range" id="overallClarity" min="0" max="2" step="0.01" value="1"></div>
<div class="slider-container"><label class="slider-label" for="overallVibrance">Vibrance</label><input type="range" id="overallVibrance" min="0" max="2" step="0.01" value="1"></div>
<div class="slider-container"><label class="slider-label" for="overallHue">Hue</label><input type="range" id="overallHue" min="0" max="360" step="1" value="0"></div>
<div class="slider-container"><label class="slider-label" for="intensity">Intensity</label><input type="range" id="intensity" min="0" max="0.1" step="0.01" value="0.02"></div>
<div class="slider-container"><label class="slider-label" for="frequency">Frequency</label><input type="range" id="frequency" min="10" max="50" step="1" value="20"></div>
<div class="slider-container"><h3 style="color:white;margin:0">Red Layer</h3><label class="slider-label" for="rAmplitude">Amplitude</label><input type="range" id="rAmplitude" min="0" max="0.1" step="0.01" value="0.03"><label class="slider-label" for="rSpeed">Speed</label><input type="range" id="rSpeed" min="0" max="10" step="0.1" value="3.0"><label class="slider-label" for="rDirection">Direction</label><input type="range" id="rDirection" min="0" max="360" step="1" value="0"><label class="slider-label" for="rPhase">Phase</label><input type="range" id="rPhase" min="0" max="6.28" step="0.01" value="0"><label class="slider-label" for="rHue">Hue</label><input type="range" id="rHue" min="0" max="360" step="1" value="0"><label class="slider-label" for="rVibrance">Vibrance</label><input type="range" id="rVibrance" min="0" max="2" step="0.01" value="1"><label class="slider-label" for="rIntensity">Intensity</label><input type="range" id="rIntensity" min="0" max="2" step="0.01" value="1"><label class="slider-label" for="rLight">Light</label><input type="range" id="rLight" min="0" max="2" step="0.01" value="1"></div>
<div class="slider-container"><h3 style="color:white;margin:0">Green Layer</h3><label class="slider-label" for="gAmplitude">Amplitude</label><input type="range" id="gAmplitude" min="0" max="0.1" step="0.01" value="0.06"><label class="slider-label" for="gSpeed">Speed</label><input type="range" id="gSpeed" min="0" max="10" step="0.1" value="6.0"><label class="slider-label" for="gDirection">Direction</label><input type="range" id="gDirection" min="0" max="360" step="1" value="120"><label class="slider-label" for="gPhase">Phase</label><input type="range" id="gPhase" min="0" max="6.28" step="0.01" value="1.57"><label class="slider-label" for="gHue">Hue</label><input type="range" id="gHue" min="0" max="360" step="1" value="120"><label class="slider-label" for="gVibrance">Vibrance</label><input type="range" id="gVibrance" min="0" max="2" step="0.01" value="1"><label class="slider-label" for="gIntensity">Intensity</label><input type="range" id="gIntensity" min="0" max="2" step="0.01" value="1"><label class="slider-label" for="gLight">Light</label><input type="range" id="gLight" min="0" max="2" step="0.01" value="1"></div>
<div class="slider-container"><h3 style="color:white;margin:0">Blue Layer</h3><label class="slider-label" for="bAmplitude">Amplitude</label><input type="range" id="bAmplitude" min="0" max="0.1" step="0.01" value="0.09"><label class="slider-label" for="bSpeed">Speed</label><input type="range" id="bSpeed" min="0" max="10" step="0.1" value="9.0"><label class="slider-label" for="bDirection">Direction</label><input type="range" id="bDirection" min="0" max="360" step="1" value="240"><label class="slider-label" for="bPhase">Phase</label><input type="range" id="bPhase" min="0" max="6.28" step="0.01" value="3.14"><label class="slider-label" for="bHue">Hue</label><input type="range" id="bHue" min="0" max="360" step="1" value="240"><label class="slider-label" for="bVibrance">Vibrance</label><input type="range" id="bVibrance" min="0" max="2" step="0.01" value="1"><label class="slider-label" for="bIntensity">Intensity</label><input type="range" id="bIntensity" min="0" max="2" step="0.01" value="1"><label class="slider-label" for="bLight">Light</label><input type="range" id="bLight" min="0" max="2" step="0.01" value="1"></div>
</div>
<canvas id="cnv"></canvas>
<video id="vid" style="display:none;" autoplay></video>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
const cnv=document.getElementById('cnv'),vid=document.getElementById('vid'),sv=document.getElementById('sv'),fs=document.getElementById('fs'),tgl=document.getElementById('tgl'),ctrls=document.getElementById('ctrls'),ot=document.getElementById('overallTexture'),oc=document.getElementById('overallClarity'),ov=document.getElementById('overallVibrance'),oh=document.getElementById('overallHue'),i=document.getElementById('intensity'),f=document.getElementById('frequency'),ra=document.getElementById('rAmplitude'),rs=document.getElementById('rSpeed'),rd=document.getElementById('rDirection'),rp=document.getElementById('rPhase'),rh=document.getElementById('rHue'),rv=document.getElementById('rVibrance'),ri=document.getElementById('rIntensity'),rl=document.getElementById('rLight'),ga=document.getElementById('gAmplitude'),gs=document.getElementById('gSpeed'),gd=document.getElementById('gDirection'),gp=document.getElementById('gPhase'),gh=document.getElementById('gHue'),gv=document.getElementById('gVibrance'),gi=document.getElementById('gIntensity'),gl=document.getElementById('gLight'),ba=document.getElementById('bAmplitude'),bs=document.getElementById('bSpeed'),bd=document.getElementById('bDirection'),bp=document.getElementById('bPhase'),bh=document.getElementById('bHue'),bv=document.getElementById('bVibrance'),bi=document.getElementById('bIntensity'),bl=document.getElementById('bLight');
const r=new THREE.WebGLRenderer({canvas:cnv,preserveDrawingBuffer:true});r.setSize(window.innerWidth,window.innerHeight);const s=new THREE.Scene(),c=new THREE.OrthographicCamera(-1,1,1,-1,0,1),g=new THREE.PlaneGeometry(2,2);
let fsh=`uniform sampler2D u_image;uniform float u_intensity,u_frequency,u_overallTexture,u_overallClarity,u_overallVibrance,u_overallHue;uniform float u_rAmplitude,u_rSpeed,u_rDirection,u_rPhase,u_rHue,u_rVibrance,u_rIntensity,u_rLight;uniform float u_gAmplitude,u_gSpeed,u_gDirection,u_gPhase,u_gHue,u_gVibrance,u_gIntensity,u_gLight;uniform float u_bAmplitude,u_bSpeed,u_bDirection,u_bPhase,u_bHue,u_bVibrance,u_bIntensity,u_bLight;varying vec2 v_uv;vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec4 p=mix(vec4(c.bg,K.wz),vec4(c.gb,K.xy),step(c.b,c.g));vec4 q=mix(vec4(p.xyw,c.r),vec4(c.r,p.yzx),step(p.x,c.r));float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.0*d+e)),d/(q.x+e),q.x);}vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 p=abs(fract(c.xxx+K.xyz)*6.0-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),c.y);}void main(){vec2 uv=v_uv;float wave=sin(uv.y*u_frequency)*u_intensity;uv+=vec2(wave);vec4 color=texture2D(u_image,uv);vec2 rOffset=vec2(sin(u_rDirection+u_rPhase)*u_rSpeed,cos(u_rDirection+u_rPhase)*u_rSpeed)*u_rAmplitude;vec2 gOffset=vec2(sin(u_gDirection+u_gPhase)*u_gSpeed,cos(u_gDirection+u_gPhase)*u_gSpeed)*u_gAmplitude;vec2 bOffset=vec2(sin(u_bDirection+u_bPhase)*u_bSpeed,cos(u_bDirection+u_bPhase)*u_bSpeed)*u_bAmplitude;vec4 rColor=texture2D(u_image,uv+rOffset);vec4 gColor=texture2D(u_image,uv+gOffset);vec4 bColor=texture2D(u_image,uv+bOffset);vec3 rHsv=rgb2hsv(rColor.rgb);rHsv.x=mod(rHsv.x+u_rHue/360.0,1.0);rHsv.y=clamp(rHsv.y*u_rVibrance,0.0,1.0);rHsv.z=clamp(rHsv.z*u_rIntensity,0.0,1.0)*u_rLight;vec3 gHsv=rgb2hsv(gColor.rgb);gHsv.x=mod(gHsv.x+u_gHue/360.0,1.0);gHsv.y=clamp(gHsv.y*u_gVibrance,0.0,1.0);gHsv.z=clamp(gHsv.z*u_gIntensity,0.0,1.0)*u_gLight;vec3 bHsv=rgb2hsv(bColor.rgb);bHsv.x=mod(bHsv.x+u_bHue/360.0,1.0);bHsv.y=clamp(bHsv.y*u_bVibrance,0.0,1.0);bHsv.z=clamp(bHsv.z*u_bIntensity,0.0,1.0)*u_bLight;color.r=hsv2rgb(rHsv).r;color.g=hsv2rgb(gHsv).g;color.b=hsv2rgb(bHsv).b;vec3 overallHsv=rgb2hsv(color.rgb);overallHsv.x=mod(overallHsv.x+u_overallHue/360.0,1.0);overallHsv.y=clamp(overallHsv.y*u_overallVibrance,0.0,1.0);overallHsv.z=clamp(overallHsv.z*u_overallClarity,0.0,1.0)*u_overallTexture;color.rgb=hsv2rgb(overallHsv);gl_FragColor=color;}`;
const vsh=`varying vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position,1.0);}`;
const material=new THREE.ShaderMaterial({uniforms:{u_image:{type:'t',value:null},u_intensity:{type:'f',value:0.02},u_frequency:{type:'f',value:20.0},u_overallTexture:{type:'f',value:1.0},u_overallClarity:{type:'f',value:1.0},u_overallVibrance:{type:'f',value:1.0},u_overallHue:{type:'f',value:0.0},u_rAmplitude:{type:'f',value:0.03},u_rSpeed:{type:'f',value:3.0},u_rDirection:{type:'f',value:0.0},u_rPhase:{type:'f',value:0.0},u_rHue:{type:'f',value:0.0},u_rVibrance:{type:'f',value:1.0},u_rIntensity:{type:'f',value:1.0},u_rLight:{type:'f',value:1.0},u_gAmplitude:{type:'f',value:0.06},u_gSpeed:{type:'f',value:6.0},u_gDirection:{type:'f',value:120.0},u_gPhase:{type:'f',value:1.57},u_gHue:{type:'f',value:120.0},u_gVibrance:{type:'f',value:1.0},u_gIntensity:{type:'f',value:1.0},u_gLight:{type:'f',value:1.0},u_bAmplitude:{type:'f',value:0.09},u_bSpeed:{type:'f',value:9.0},u_bDirection:{type:'f',value:240.0},u_bPhase:{type:'f',value:3.14},u_bHue:{type:'f',value:240.0},u_bVibrance:{type:'f',value:1.0},u_bIntensity:{type:'f',value:1.0},u_bLight:{type:'f',value:1.0}},vertexShader:vsh,fragmentShader:fsh});
const mesh=new THREE.Mesh(g,material);s.add(mesh);

navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}}}).then(stream=>{vid.srcObject=stream;vid.play();}).catch(err=>{console.error('Error accessing webcam:',err);});

function updateTexture(){
  const texture=new THREE.VideoTexture(vid);
  texture.needsUpdate=true;
  material.uniforms.u_image.value=texture;
  r.render(s,c);
}

vid.addEventListener('play',()=>{updateTexture();});

function updateUniforms(){material.uniforms.u_intensity.value=parseFloat(i.value);material.uniforms.u_frequency.value=parseFloat(f.value);material.uniforms.u_overallTexture.value=parseFloat(ot.value);material.uniforms.u_overallClarity.value=parseFloat(oc.value);material.uniforms.u_overallVibrance.value=parseFloat(ov.value);material.uniforms.u_overallHue.value=parseFloat(oh.value);material.uniforms.u_rAmplitude.value=parseFloat(ra.value);material.uniforms.u_rSpeed.value=parseFloat(rs.value);material.uniforms.u_rDirection.value=parseFloat(rd.value);material.uniforms.u_rPhase.value=parseFloat(rp.value);material.uniforms.u_rHue.value=parseFloat(rh.value);material.uniforms.u_rVibrance.value=parseFloat(rv.value);material.uniforms.u_rIntensity.value=parseFloat(ri.value);material.uniforms.u_rLight.value=parseFloat(rl.value);material.uniforms.u_gAmplitude.value=parseFloat(ga.value);material.uniforms.u_gSpeed.value=parseFloat(gs.value);material.uniforms.u_gDirection.value=parseFloat(gd.value);material.uniforms.u_gPhase.value=parseFloat(gp.value);material.uniforms.u_gHue.value=parseFloat(gh.value);material.uniforms.u_gVibrance.value=parseFloat(gv.value);material.uniforms.u_gIntensity.value=parseFloat(gi.value);material.uniforms.u_gLight.value=parseFloat(gl.value);material.uniforms.u_bAmplitude.value=parseFloat(ba.value);material.uniforms.u_bSpeed.value=parseFloat(bs.value);material.uniforms.u_bDirection.value=parseFloat(bd.value);material.uniforms.u_bPhase.value=parseFloat(bp.value);material.uniforms.u_bHue.value=parseFloat(bh.value);material.uniforms.u_bVibrance.value=parseFloat(bv.value);material.uniforms.u_bIntensity.value=parseFloat(bi.value);material.uniforms.u_bLight.value=parseFloat(bl.value);r.render(s,c);}

[ot,oc,ov,oh,i,f,ra,rs,rd,rp,rh,rv,ri,rl,ga,gs,gd,gp,gh,gv,gi,gl,ba,bs,bd,bp,bh,bv,bi,bl].forEach(slider=>{slider.addEventListener('input',updateUniforms);});

sv.addEventListener('click',()=>{r.setSize(window.innerWidth*2,window.innerHeight*2);r.render(s,c);cnv.toBlob(blob=>{const link=document.createElement('a');const filename=`enhanced_vision_${Date.now()}.png`;link.download=filename;link.href=URL.createObjectURL(blob);link.click();r.setSize(window.innerWidth,window.innerHeight);r.render(s,c);},'image/png');});

tgl.addEventListener('click',()=>{ctrls.style.display=ctrls.style.display==='none'?'flex':'none';});

fs.addEventListener('click',()=>{if(!document.fullscreenElement){document.documentElement.requestFullscreen();}else{if(document.exitFullscreen){document.exitFullscreen();}}});

cnv.addEventListener('click',()=>{const display=ctrls.style.display==='none'?'flex':'none';ctrls.style.display=display;[tgl,fs,sv].forEach(button=>{button.style.display=display;});});

function handleOrientation(event){const gamma=event.gamma,beta=event.beta;material.uniforms.u_rDirection.value=(gamma+180)%360;material.uniforms.u_gDirection.value=(beta+180)%360;material.uniforms.u_bDirection.value=(gamma+beta+360)%360;r.render(s,c);}

window.addEventListener('deviceorientation',handleOrientation);
r.render(s,c);
</script>
</body>
</HTML>

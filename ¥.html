<html><head><meta charset="viewport" content="width=device-width,initial-scale=1.0"><title>Ckra System with NN</title><style>body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;cursor:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script>function sigmoid(x){return 1/(1+Math.exp(-x))}function NN(inputNodes,hNodes,oNodes){this.inputNodes=inputNodes;this.hNodes=hNodes;this.oNodes=oNodes;this.weightsIH=Array(hNodes).fill(0).map(()=>Array(inputNodes).fill(0).map(()=>Math.random()*2-1));this.weightsHO=Array(oNodes).fill(0).map(()=>Array(hNodes).fill(0).map(()=>Math.random()*2-1));this.biasH=Array(hNodes).fill(0).map(()=>Math.random()*2-1);this.biasO=Array(oNodes).fill(0).map(()=>Math.random()*2-1);this.feedforward=function(inputArray){let hidden=Array(this.hNodes).fill(0);for(let i=0;i<this.hNodes;i++){hidden[i]=this.biasH[i];for(let j=0;j<this.inputNodes;j++){hidden[i]+=this.weightsIH[i][j]*inputArray[j]}hidden[i]=sigmoid(hidden[i])}let output=Array(this.oNodes).fill(0);for(let i=0;i<this.oNodes;i++){output[i]=this.biasO[i];for(let j=0;j<this.hNodes;j++){output[i]+=this.weightsHO[i][j]*hidden[j]}output[i]=sigmoid(output[i])}return output}}const scene=new THREE.Scene(),camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);camera.position.z=8;const renderer=new THREE.WebGLRenderer({antialias:true,canvas:document.getElementById("c")});renderer.setSize(window.innerWidth,window.innerHeight);const ckraColors=["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#8B00FF"],res=["energy","light","warmth"],geometry=new THREE.CircleGeometry(1,16),material=new THREE.MeshBasicMaterial({color:"#FFFFFF",wireframe:true,transparent:true,opacity:0.7}),ckras=[],classes=["α","β","γ","δ","ε","ζ"],intents=["seekResource","avoidConflict","formAlliance","trade","explore","wander","warp","pattern","spiral"];let globalSpeed=0.03,popCap=20;const worldStructs=[];function createCkra(i,level=1){if(ckras.length>=popCap)return;const ckra=new THREE.Mesh(geometry.clone(),material.clone());ckra.material.color.set(ckraColors[i%ckraColors.length]);ckra.position.set(Math.sin(i*Math.PI/3.5)*3,Math.cos(i*Math.PI/3.5)*3,(i%2===0?-1:1)*Math.random()*2);scene.add(ckra);const nn=new NN(5,10,1);const ckraClass=classes[Math.floor(Math.random()*classes.length)];const ckraData={mesh:ckra,nn:nn,intent:intents[Math.floor(Math.random()*intents.length)],speed:globalSpeed,direction:1,sDir:1,level:level,exp:0,evoThresh:5*level,warpFactor:Math.random()*0.05,patternFactor:Math.random()*0.05,bScore:100,cThresh:20,memory:[],learningRate:0.1,class:ckraClass,res:{energy:Math.random()*10,light:Math.random()*10,warmth:Math.random()*10}};ckras.push(ckraData)}for(let i=0;i<7;i++)createCkra(i);function evolveCkra(ckra){ckra.level++;ckra.speed+=0.01;ckra.mesh.scale.set(ckra.level,ckra.level,1);ckra.mesh.material.color.set(ckraColors[ckra.level%ckraColors.length]);ckra.evoThresh*=1.5;ckra.exp=0;if(ckra.level>=3&&ckras.length<popCap)createCkra(ckras.length,1)}function cullCkras(){for(let i=ckras.length-1;i>=0;i--){if(ckras[i].bScore<ckras[i].cThresh||ckras[i].res.energy<=0||ckras[i].res.light<=0||ckras[i].res.warmth<=0){scene.remove(ckras[i].mesh);ckras.splice(i,1);cleanupMemory()}}}function cleanupMemory(){ckras.length=ckras.length}function adjustParams(){if(ckras.length>popCap*0.75){ckras.forEach(ckra=>{ckra.cThresh+=5;ckra.evoThresh*=1.2})}else if(ckras.length<popCap*0.5){ckras.forEach(ckra=>{ckra.cThresh-=5;ckra.evoThresh/=1.2})}}function chooseBehavior(ckra){const inputs=[ckra.res.energy/10,ckra.res.light/10,ckra.res.warmth/10,Math.random(),Math.random()];const output=ckra.nn.feedforward(inputs);const index=Math.floor(output[0]*intents.length);ckra.intent=intents[index]}function manageRes(ckra){ckra.res.energy-=0.01;ckra.res.light-=0.01;ckra.res.warmth-=0.01;if(ckra.res.energy<5||ckra.res.light<5||ckra.res.warmth<5)ckra.intent="seekResource"}function gatherRes(ckra){ckra.res.energy+=Math.random()*2;ckra.res.light+=Math.random()*2;ckra.res.warmth+=Math.random()*2}function tradeRes(ckra1,ckra2){if(ckra1.res.energy>ckra2.res.energy){ckra1.res.energy-=1;ckra2.res.energy+=1}if(ckra1.res.light>ckra2.res.light){ckra1.res.light-=1;ckra2.res.light+=1}if(ckra1.res.warmth>ckra2.res.warmth){ckra1.res.warmth-=1;ckra2.res.warmth+=1}}function interpretSignal(ckra,signal){ckra.exp+=0.1;if(ckra.exp>=ckra.evoThresh)evolveCkra(ckra);chooseBehavior(ckra);switch(signal){case"seekResource":gatherRes(ckra);ckra.bScore+=1;break;case"avoidConflict":ckra.mesh.position.x-=ckra.sDir*0.05;ckra.mesh.position.y-=ckra.sDir*0.05;ckra.bScore+=1;break;case"formAlliance":ckra.mesh.position.x+=Math.sin(Date.now()*0.001*ckra.speed);ckra.mesh.position.y+=Math.cos(Date.now()*0.001*ckra.speed);ckra.bScore+=2;break;case"trade":{const otherCkra=ckras[Math.floor(Math.random()*ckras.length)];if(otherCkra!==ckra)tradeRes(ckra,otherCkra);ckra.bScore+=2;break;}case"warp":warpMove(ckra);ckra.bScore+=1;break;case"pattern":patternMove(ckra);ckra.bScore+=1;break;case"spiral":spiralMove(ckra);ckra.bScore+=1;break;default:ckra.bScore-=0.5;}}function warpMove(ckra){const time=Date.now()*ckra.warpFactor;ckra.mesh.position.x+=Math.sin(time*ckra.speed)*0.05;ckra.mesh.position.y+=Math.sin(time*ckra.speed)*0.05}function patternMove(ckra){const time=Date.now()*ckra.patternFactor;ckra.mesh.position.x+=Math.sin(time)*0.05;ckra.mesh.position.y+=Math.cos(time*2)*0.05}function spiralMove(ckra){const time=Date.now()*ckra.speed;ckra.mesh.position.x+=Math.sin(time)*0.05*time*0.001;ckra.mesh.position.y+=Math.cos(time)*0.05*time*0.001}function updateCkras(){ckras.forEach(ckra=>{ckra.mesh.rotation.z+=ckra.speed*ckra.direction;ckra.mesh.scale.x+=ckra.sDir*0.005;ckra.mesh.scale.y=ckra.mesh.scale.x;if(ckra.mesh.scale.x>1.2||ckra.mesh.scale.x<0.8)ckra.sDir*=-1;manageRes(ckra);interpretSignal(ckra,ckra.intent);handleClassBehavior(ckra)});cullCkras();adjustParams();updateWorld()}function handleClassBehavior(ckra){switch(ckra.class){case"α":ckra.speed*=1.01;ckra.bScore+=1;break;case"β":warriorBehavior(ckra);break;case"γ":farmerBehavior(ckra);break;case"δ":hunterBehavior(ckra);break;case"ε":builderBehavior(ckra);break;case"ζ":wisdomBehavior(ckra);break;default:break;}}function warriorBehavior(ckra){ckra.mesh.material.color.set("#FF4500");ckra.mesh.rotation.z+=ckra.speed*ckra.direction*1.5;if(Math.random()<0.05){const nearbyEnemy=findNearbyCkra(ckra,"β");if(nearbyEnemy)ckra.intent="avoidConflict"}}function farmerBehavior(ckra){ckra.mesh.material.color.set("#32CD32");ckra.intent="seekResource";if(ckra.res.energy>8&&ckra.res.light>8&&ckra.res.warmth>8){ckra.intent="formAlliance";plantCrop(ckra)}}function hunterBehavior(ckra){ckra.mesh.material.color.set("#8B4513");ckra.intent="wander";const nearbyPrey=findNearbyCkra(ckra,"δ");if(nearbyPrey)ckra.intent="seekResource"}function builderBehavior(ckra){ckra.mesh.material.color.set("#DAA520");ckra.intent="pattern";if(ckra.exp>ckra.evoThresh/2){ckra.intent="formAlliance";buildStructure(ckra)}if(ckra.res.energy>ckra.evoThresh){ckra.intent="createAdvStructure";buildAdvStructure(ckra)}}function wisdomBehavior(ckra){ckra.mesh.material.color.set("#00CED1");ckra.intent="explore";ckra.mesh.scale.x+=0.002;ckra.mesh.scale.y+=0.002;if(ckra.res.energy>ckra.evoThresh)ckra.intent="warp"}function findNearbyCkra(ckra,classType){const range=3;for(let i=0;i<ckras.length;i++){const other=ckras[i];if(other.class!==classType&&ckra.mesh.position.distanceTo(other.mesh.position)<range)return other}return null}function plantCrop(ckra){const crop=new THREE.Mesh(new THREE.BoxGeometry(0.2,0.2,0.2),new THREE.MeshBasicMaterial({color:"#228B22"}));crop.position.copy(ckra.mesh.position);scene.add(crop);worldStructs.push(crop)}function buildStructure(ckra){const structure=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:"#A52A2A"}));structure.position.copy(ckra.mesh.position);scene.add(structure);worldStructs.push(structure)}function buildAdvStructure(ckra){const advStructure=new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.5,2,16),new THREE.MeshBasicMaterial({color:"#8A2BE2"}));advStructure.position.copy(ckra.mesh.position);scene.add(advStructure);worldStructs.push(advStructure)}function updateWorld(){worldStructs.forEach(structure=>{structure.rotation.y+=0.01;structure.rotation.x+=0.01})}function animate(){requestAnimationFrame(animate);updateCkras();renderer.render(scene,camera)}animate();</script></body></html>

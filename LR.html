<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Layered Reality</title><style>body,html{margin:0;overflow:hidden}canvas{display:block;width:100vw;height:100vh}#controls{position:absolute;top:10px;left:10px;z-index:10;display:none;flex-direction:column;gap:10px;background-color:rgba(0,0,0,0.5);padding:10px;border-radius:10px;max-height:90vh;overflow-y:auto}.slider-container{display:flex;flex-direction:column;gap:5px}#button-container{position:absolute;top:10px;right:10px;z-index:10;display:flex;gap:10px}#toggle-controls,#upload,#save,#fullscreen{z-index:10}.slider-label{color:white}</style></head><body><div id="button-container"><button id="toggle-controls">Toggle Controls</button><button id="fullscreen">Fullscreen</button><input type="file" id="upload" accept="image/*"><button id="save">Save Image</button></div><div id="controls"><div class="slider-container"><label class="slider-label" for="intensity">Overall Intensity</label><input type="range" id="intensity" min="0" max="0.1" step="0.01" value="0.02"></div><div class="slider-container"><label class="slider-label" for="frequency">Overall Frequency</label><input type="range" id="frequency" min="10" max="50" step="1" value="20"></div><div class="slider-container"><h3 style="color:white;margin:0">Red Layer</h3><label class="slider-label" for="rAmplitude">Amplitude</label><input type="range" id="rAmplitude" min="0" max="0.1" step="0.01" value="0.1"><label class="slider-label" for="rSpeed">Speed</label><input type="range" id="rSpeed" min="0" max="10" step="0.1" value="1.0"><label class="slider-label" for="rDirection">Direction</label><input type="range" id="rDirection" min="0" max="360" step="1" value="0"></div><div class="slider-container"><h3 style="color:white;margin:0">Green Layer</h3><label class="slider-label" for="gAmplitude">Amplitude</label><input type="range" id="gAmplitude" min="0" max="0.1" step="0.01" value="0.1"><label class="slider-label" for="gSpeed">Speed</label><input type="range" id="gSpeed" min="0" max="10" step="0.1" value="1.0"><label class="slider-label" for="gDirection">Direction</label><input type="range" id="gDirection" min="0" max="360" step="1" value="120"></div><div class="slider-container"><h3 style="color:white;margin:0">Blue Layer</h3><label class="slider-label" for="bAmplitude">Amplitude</label><input type="range" id="bAmplitude" min="0" max="0.1" step="0.01" value="0.1"><label class="slider-label" for="bSpeed">Speed</label><input type="range" id="bSpeed" min="0" max="10" step="0.1" value="1.0"><label class="slider-label" for="bDirection">Direction</label><input type="range" id="bDirection" min="0" max="360" step="1" value="240"></div></div><canvas id="canvas"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script>const canvas=document.getElementById('canvas'),upload=document.getElementById('upload'),saveButton=document.getElementById('save'),fullscreenButton=document.getElementById('fullscreen'),toggleControlsButton=document.getElementById('toggle-controls'),controls=document.getElementById('controls'),buttonContainer=document.getElementById('button-container'),intensitySlider=document.getElementById('intensity'),frequencySlider=document.getElementById('frequency'),rAmplitudeSlider=document.getElementById('rAmplitude'),rSpeedSlider=document.getElementById('rSpeed'),rDirectionSlider=document.getElementById('rDirection'),gAmplitudeSlider=document.getElementById('gAmplitude'),gSpeedSlider=document.getElementById('gSpeed'),gDirectionSlider=document.getElementById('gDirection'),bAmplitudeSlider=document.getElementById('bAmplitude'),bSpeedSlider=document.getElementById('bSpeed'),bDirectionSlider=document.getElementById('bDirection');const renderer=new THREE.WebGLRenderer({canvas,preserveDrawingBuffer:true});renderer.setSize(window.innerWidth*2,window.innerHeight*2);const scene=new THREE.Scene(),camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),geometry=new THREE.PlaneGeometry(2,2);let fragmentShader=`uniform sampler2D u_image;uniform float u_intensity;uniform float u_frequency;uniform float u_rAmplitude;uniform float u_rSpeed;uniform float u_rDirection;uniform float u_gAmplitude;uniform float u_gSpeed;uniform float u_gDirection;uniform float u_bAmplitude;uniform float u_bSpeed;uniform float u_bDirection;varying vec2 v_uv;void main() {vec2 uv = v_uv;float wave = sin(uv.y * u_frequency) * u_intensity;uv.x += wave;uv.y += wave;vec4 color = texture2D(u_image, uv);vec2 rOffset = vec2(sin(u_rDirection) * u_rSpeed, cos(u_rDirection) * u_rSpeed) * u_rAmplitude;vec2 gOffset = vec2(sin(u_gDirection) * u_gSpeed, cos(u_gDirection) * u_gSpeed) * u_gAmplitude;vec2 bOffset = vec2(sin(u_bDirection) * u_bSpeed, cos(u_bDirection) * u_bSpeed) * u_bAmplitude;color.r = texture2D(u_image, uv + rOffset).r;color.g = texture2D(u_image, uv + gOffset).g;color.b = texture2D(u_image, uv + bOffset).b;gl_FragColor = color;}`;const vertexShader=`varying vec2 v_uv;void main() {v_uv = uv;gl_Position = vec4(position, 1.0);}`;const material=new THREE.ShaderMaterial({uniforms:{u_image:{type:'t',value:null},u_intensity:{type:'f',value:0.02},u_frequency:{type:'f',value:20.0},u_rAmplitude:{type:'f',value:0.1},u_rSpeed:{type:'f',value:1.0},u_rDirection:{type:'f',value:0.0},u_gAmplitude:{type:'f',value:0.1},u_gSpeed:{type:'f',value:1.0},u_gDirection:{type:'f',value:120.0},u_bAmplitude:{type:'f',value:0.1},u_bSpeed:{type:'f',value:1.0},u_bDirection:{type:'f',value:240.0}},vertexShader,fragmentShader});const mesh=new THREE.Mesh(geometry,material);scene.add(mesh);upload.addEventListener('change',(e)=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=(event)=>{const img=new Image();img.onload=()=>{const texture=new THREE.Texture(img);texture.needsUpdate=true;material.uniforms.u_image.value=texture;renderer.setSize(window.innerWidth,window.innerHeight);renderer.render(scene,camera);};img.src=event.target.result;};reader.readAsDataURL(file);}});function updateUniforms(){material.uniforms.u_intensity.value=parseFloat(intensitySlider.value);material.uniforms.u_frequency.value=parseFloat(frequencySlider.value);material.uniforms.u_rAmplitude.value=parseFloat(rAmplitudeSlider.value);material.uniforms.u_rSpeed.value=parseFloat(rSpeedSlider.value);material.uniforms.u_rDirection.value=parseFloat(rDirectionSlider.value);material.uniforms.u_gAmplitude.value=parseFloat(gAmplitudeSlider.value);material.uniforms.u_gSpeed.value=parseFloat(gSpeedSlider.value);material.uniforms.u_gDirection.value=parseFloat(gDirectionSlider.value);material.uniforms.u_bAmplitude.value=parseFloat(bAmplitudeSlider.value);material.uniforms.u_bSpeed.value=parseFloat(bSpeedSlider.value);material.uniforms.u_bDirection.value=parseFloat(bDirectionSlider.value);renderer.render(scene,camera);} [intensitySlider,frequencySlider,rAmplitudeSlider,rSpeedSlider,rDirectionSlider,gAmplitudeSlider,gSpeedSlider,gDirectionSlider,bAmplitudeSlider,bSpeedSlider,bDirectionSlider].forEach(slider=>{slider.addEventListener('input',updateUniforms);});saveButton.addEventListener('click',()=>{renderer.setSize(window.innerWidth*2,window.innerHeight*2);renderer.render(scene,camera);canvas.toBlob((blob)=>{const link=document.createElement('a');const uniqueFilename=`trippy-image-${Date.now()}.png`;link.download=uniqueFilename;link.href=URL.createObjectURL(blob);link.click();renderer.setSize(window.innerWidth,window.innerHeight);renderer.render(scene,camera);},'image/png');});toggleControlsButton.addEventListener('click',()=>{controls.style.display=controls.style.display==='none'?'flex':'none';});fullscreenButton.addEventListener('click',()=>{if(!document.fullscreenElement){document.documentElement.requestFullscreen();}else{if(document.exitFullscreen){document.exitFullscreen();}}});canvas.addEventListener('click',()=>{const display=controls.style.display==='none'?'flex':'none';controls.style.display=display;[toggleControlsButton,fullscreenButton,upload,saveButton].forEach(button=>{button.style.display=display;});});function handleOrientation(event){const gamma=event.gamma, beta=event.beta;material.uniforms.u_rDirection.value=(gamma+180)%360;material.uniforms.u_gDirection.value=(beta+180)%360;material.uniforms.u_bDirection.value=(gamma+beta+360)%360;renderer.render(scene,camera);}window.addEventListener('deviceorientation',handleOrientation);renderer.render(scene,camera);</script></body></html>
